// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id          Int          @id @default(autoincrement())
  uid         String       @unique
  email       String       @unique
  name        String?
  photoUrl    String?
  active      Boolean      @default(true)
  teamMembers TeamMember[]
}

model Team {
  id           Int           @id @default(autoincrement())
  name         String
  active       Boolean       @default(true)
  teamMembers  TeamMember[]
  teamProjects TeamProject[]
}

model TeamMember {
  user   User    @relation(fields: [userId], references: [id])
  userId Int
  team   Team    @relation(fields: [teamId], references: [id])
  teamId Int
  active Boolean @default(true)

  @@id([userId, teamId])
}

model Project {
  id           Int           @id @default(autoincrement())
  name         String
  slug         String        @unique
  active       Boolean       @default(true)
  teamProjects TeamProject[]
  environments Environment[]
}

model TeamProject {
  team      Team    @relation(fields: [teamId], references: [id])
  teamId    Int
  project   Project @relation(fields: [projectId], references: [id])
  projectId Int
  active    Boolean @default(true)

  @@id([teamId, projectId])
}

enum Net {
  MAINNET
  TESTNET
}

model ApiKey {
  reference     String      @id
  net           Net
  environment   Environment @relation(fields: [environmentId], references: [id])
  environmentId Int
  active        Boolean     @default(true)
}

model Environment {
  id        Int        @id @default(autoincrement())
  name      String
  project   Project    @relation(fields: [projectId], references: [id])
  projectId Int
  net       Net
  subId     Int
  active    Boolean    @default(true)
  apiKeys   ApiKey[]
  contracts Contract[]

  @@unique([projectId, subId])
}

model Contract {
  id            Int         @id @default(autoincrement())
  environment   Environment @relation(fields: [environmentId], references: [id])
  environmentId Int
  address       String
  net           Net
  active        Boolean     @default(true)
}
